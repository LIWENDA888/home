<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小红书卡片生成</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* --- 引入本地字体 --- */
        @font-face {
            font-family: 'UserFont';
            src: url('123.ttf') format('truetype');
            font-display: swap;
        }

        /* --- 0. 全局设置 --- */
        :root {
            --ui-bg: #0F0F0F;
            --ui-panel: #1A1A1A;
            --ui-border: #333333;
            --ui-text-main: #FFFFFF;
            --ui-text-sub: #888888;
            --ui-accent: #2B65D9;
            --ui-radius: 8px;

            /* 画布变量 */
            --p-bg: #F0F0F0; 
            --p-ink: #111111; 
            --p-sub: #666666;
            --p-line: rgba(0,0,0,0.1);
            --p-mark: rgba(0,0,0,0.8);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; outline: none; }
        
        body {
            background-color: var(--ui-bg); 
            color: var(--ui-text-main);
            font-family: "PingFang SC", "Microsoft YaHei", "Helvetica Neue", sans-serif;
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 60px; 
            -webkit-font-smoothing: antialiased;
        }

        .tabular-nums { font-variant-numeric: tabular-nums; font-feature-settings: "tnum"; letter-spacing: 0px; }

        /* --- 左侧控制台 --- */
        .sidebar {
            width: 320px;
            height: 840px; 
            background: var(--ui-panel); 
            border: 1px solid var(--ui-border); 
            border-radius: var(--ui-radius);
            display: flex; flex-direction: column;
            box-shadow: 0 50px 100px rgba(0,0,0,0.6);
            z-index: 20;
        }

        .panel-section { 
            padding: 24px 22px; 
            border-bottom: 1px solid var(--ui-border); 
            display: flex; flex-direction: column; gap: 20px;
        }
        .panel-section:last-child { border-bottom: none; margin-top: auto; padding-bottom: 24px; }

        .sec-title {
            font-size: 12px; font-weight: 700; color: var(--ui-text-sub); 
            text-transform: uppercase; letter-spacing: 0.5px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .control-row { display: flex; flex-direction: column; gap: 10px; }
        
        .control-header { 
            display: flex; justify-content: space-between; align-items: center;
            font-size: 12px; color: var(--ui-text-sub); 
            height: 20px;
        }

        .input-val-group { display: flex; align-items: center; gap: 6px; }
        .desc-label { font-size: 10px; color: var(--ui-text-sub); opacity: 0.7; font-weight: 400; }
        
        .val-input {
            width: 50px;
            background: #262626;
            border: 1px solid #333;
            border-radius: 4px;
            color: var(--ui-text-main);
            font-family: inherit;
            font-weight: 700;
            font-size: 12px;
            text-align: center;
            padding: 2px 0;
            cursor: text;
            transition: all 0.2s;
        }
        .val-input:focus { border-color: var(--ui-accent); background: #000; }
        .val-input::-webkit-outer-spin-button, .val-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        .slider-group { display: flex; align-items: center; gap: 10px; height: 28px; }

        input[type=range] {
            flex: 1; height: 4px; background: #333; border-radius: 2px;
            appearance: none; cursor: pointer; transition: background 0.2s;
        }
        input[type=range]:hover { background: #444; }
        input[type=range]::-webkit-slider-thumb {
            appearance: none; width: 16px; height: 16px; 
            background: #fff; border-radius: 50%; border: 2px solid #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.5); 
            transition: transform 0.1s, border-color 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); border-color: var(--ui-accent); }

        .btn-play {
            width: 28px; height: 28px; flex-shrink: 0;
            background: #2A2A2A; border: 1px solid #444; border-radius: 4px;
            color: #fff; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
        }
        .btn-play:hover { background: #444; border-color: #666; }
        .btn-play.playing { background: var(--ui-accent); border-color: var(--ui-accent); }
        .btn-play svg { width: 12px; height: 12px; fill: currentColor; }
        .btn-placeholder { width: 28px; height: 28px; flex-shrink: 0; }

        .align-group { display: flex; background: #262626; border-radius: var(--ui-radius); padding: 3px; border: 1px solid #333; }
        .align-btn { 
            flex: 1; text-align: center; padding: 6px; font-size: 12px; color: #666; 
            cursor: pointer; border-radius: 4px; transition: 0.2s;
        }
        .align-btn.active { background: #444; color: #fff; font-weight: 600; }

        .btn-action {
            width: 100%; padding: 14px; border: none; border-radius: var(--ui-radius); 
            font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 10px;
            transition: 0.2s;
        }
        .btn-primary { background: var(--ui-text-main); color: #000; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-sec { background: transparent; border: 1px solid var(--ui-border); color: var(--ui-text-sub); }
        .btn-sec:hover { border-color: #666; color: #fff; background: #262626; }

        /* --- 画布核心 --- */
        .canvas-wrap {
            width: 600px; height: 800px; 
            box-shadow: 0 0 0 1px #222, 0 30px 80px -10px rgba(0,0,0,0.7);
            border-radius: 2px; overflow: hidden;
            position: relative;
        }

        .poster {
            width: 100%; height: 100%; position: relative; overflow: hidden;
            background-color: var(--p-bg); color: var(--p-ink);
            transition: background 0.3s, color 0.3s;
            font-family: "PingFang SC", "Microsoft YaHei", "Helvetica Neue", sans-serif; 
        }

        .poster::before {
            content: ''; position: absolute; inset: 0; pointer-events: none; z-index: 90; opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            mix-blend-mode: multiply;
        }

        .layer { position: absolute; pointer-events: none; width: 100%; }
        
        .typo-label { font-size: 10px; font-weight: 700; letter-spacing: 0.5px; opacity: 0.5; text-transform: uppercase; }
        
        .stage {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; display: flex; justify-content: center; z-index: 10;
        }
        .main-text {
            font-family: 'UserFont', "PingFang SC", sans-serif; 
            font-weight: normal; font-style: normal; font-stretch: normal;
            white-space: pre-wrap; line-height: 1.0; 
            pointer-events: auto; cursor: text; 
        }

        /* --- 装饰性元素 --- */
        .crop-marks { position: absolute; inset: 20px; pointer-events: none; z-index: 5; }
        .crop-corner {
            position: absolute; width: 10px; height: 10px;
            border-color: var(--p-mark); border-style: solid; opacity: 0.5;
        }
        .c-tl { top: 0; left: 0; border-width: 1px 0 0 1px; }
        .c-tr { top: 0; right: 0; border-width: 1px 1px 0 0; }
        .c-bl { bottom: 0; left: 0; border-width: 0 0 1px 1px; }
        .c-br { bottom: 0; right: 0; border-width: 0 1px 1px 0; }

        .center-cross {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 12px; height: 12px; pointer-events: none; opacity: 0.15;
        }
        .center-cross::before, .center-cross::after { content: ''; position: absolute; background: var(--p-ink); }
        .center-cross::before { top: 5px; left: 0; right: 0; height: 1px; } 
        .center-cross::after { left: 5px; top: 0; bottom: 0; width: 1px; } 

        .spec-watermark {
            position: absolute; top: -5%; left: -6%; 
            font-size: 320px; 
            font-weight: 900; 
            /* 经典西文无衬线 */
            font-family: "Helvetica Neue", "Helvetica", "Arial", sans-serif; 
            opacity: 0.04; 
            color: var(--p-ink); 
            line-height: 0.8; 
            mix-blend-mode: multiply; 
        }
        
        .spec-header {
            top: 50px; padding: 0 50px;
            display: flex; align-items: center; justify-content: flex-start; gap: 16px;
            z-index: 20;
        }
        .tag-pill {
            border: 1px solid var(--p-ink); color: var(--p-ink);
            padding: 3px 8px; border-radius: 4px; 
            font-size: 10px; font-weight: 700; letter-spacing: 0.5px;
            background: transparent;
        }
        .poster[style*="--p-bg: #0A0A0A"] .tag-pill {
            background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.2);
        }

        .spec-bar-top {
            top: 96px; left: 50px; right: 50px; height: 1px; background: var(--p-ink); position: absolute; width: auto; opacity: 0.1;
        }
        .spec-info-col {
            top: 52px; right: 50px; text-align: right; 
            display: flex; flex-direction: column; gap: 4px;
            width: auto; left: auto;
        }
        
        .spec-footer {
            bottom: 50px; padding: 0 50px;
            display: flex; justify-content: space-between; align-items: flex-end;
            padding-top: 24px;
        }
        .spec-footer::before {
            content:''; position: absolute; top: 0; left: 50px; right: 50px; height: 1px;
            background: var(--p-ink); opacity: 0.1;
        }
        
        .b-footer-left { display: flex; align-items: center; gap: 32px; }
        
        .data-block { display: flex; flex-direction: column; gap: 2px; position: relative; }
        .data-block::before {
            content: ''; position: absolute; left: -16px; top: 4px; bottom: 4px;
            width: 1px; background: var(--p-ink); opacity: 0.1;
        }
        .b-footer-left .data-block:first-child::before { display: none; }

        .data-label {
            font-size: 9px; color: var(--p-sub); letter-spacing: 1px; text-transform: uppercase;
            font-weight: 700; opacity: 0.8;
        }
        .data-val {
            font-size: 16px; font-weight: 700; color: var(--p-ink);
            line-height: 1.1; letter-spacing: -0.5px; 
        }
        .data-desc {
            font-size: 9px; color: var(--p-ink); opacity: 0.5; font-weight: 500;
        }

        .b-footer-right { 
            display: flex; flex-direction: column; align-items: flex-end; gap: 14px;
        }
        .color-scale { display: flex; gap: 0; border: 1px solid rgba(0,0,0,0.1); overflow: hidden; border-radius: 2px; }
        .scale-block { width: 10px; height: 10px; }

        .credit-text {
            font-size: 10px; font-weight: 500; color: var(--p-ink); opacity: 0.3; 
            letter-spacing: 0.5px;
        }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="panel-section">
            <span class="sec-title">1. 字体参数 / Axis</span>
            
            <div class="control-row">
                <div class="control-header">
                    <span>字重 Weight</span> 
                    <div class="input-val-group">
                        <span class="desc-label" id="desc-w">常规</span>
                        <input type="number" class="val-input tabular-nums" id="in-val-w" value="400" min="100" max="700" onchange="updateFromInput('w')">
                    </div>
                </div>
                <div class="slider-group">
                    <input type="range" id="i-w" min="100" max="700" step="1" value="400" oninput="updateFromSlider('w')">
                    <button class="btn-play" id="btn-play-w" onclick="toggleAnim('w')" title="播放字重呼吸">
                        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                </div>
            </div>

            <div class="control-row">
                <div class="control-header">
                    <span>字宽 Width</span> 
                    <div class="input-val-group">
                        <span class="desc-label" id="desc-d">标准</span>
                        <input type="number" class="val-input tabular-nums" id="in-val-d" value="100" min="75" max="125" step="0.1" onchange="updateFromInput('d')">
                    </div>
                </div>
                <div class="slider-group">
                    <input type="range" id="i-d" min="75" max="125" step="0.1" value="100" oninput="updateFromSlider('d')">
                    <button class="btn-play" id="btn-play-d" onclick="toggleAnim('d')" title="播放字宽呼吸">
                        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="panel-section">
            <div class="sec-title" style="margin-bottom:8px;">
                <span>2. 排版与位置 / Layout</span>
                <span style="cursor:pointer; opacity:0.5; font-size:10px; font-weight:400;" onclick="resetPos()">[复位居中]</span>
            </div>
            
            <div class="align-group" style="margin-bottom:8px;">
                <div class="align-btn" onclick="setAlign('left')" id="a-left">左对齐</div>
                <div class="align-btn active" onclick="setAlign('center')" id="a-center">居中</div>
                <div class="align-btn" onclick="setAlign('right')" id="a-right">右对齐</div>
            </div>

            <div class="control-row">
                <div class="control-header">
                    <span>字号 Size</span> 
                    <input type="number" class="val-input tabular-nums" id="in-val-s" value="140" min="40" max="400" onchange="updateFromInput('s')">
                </div>
                <div class="slider-group">
                    <input type="range" id="i-s" min="40" max="400" value="140" oninput="updateFromSlider('s')">
                    <div class="btn-placeholder"></div>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-header">
                    <span>水平位移 X</span> 
                    <input type="number" class="val-input tabular-nums" id="in-val-x" value="0" min="-300" max="300" onchange="updateFromInput('x')">
                </div>
                <div class="slider-group">
                    <input type="range" id="i-x" min="-300" max="300" value="0" oninput="updateFromSlider('x')">
                    <div class="btn-placeholder"></div>
                </div>
            </div>

            <div class="control-row">
                <div class="control-header">
                    <span>垂直位移 Y</span> 
                    <input type="number" class="val-input tabular-nums" id="in-val-y" value="0" min="-300" max="300" onchange="updateFromInput('y')">
                </div>
                <div class="slider-group">
                    <input type="range" id="i-y" min="-300" max="300" value="0" oninput="updateFromSlider('y')">
                    <div class="btn-placeholder"></div>
                </div>
            </div>
        </div>

        <div class="panel-section">
            <button class="btn-action btn-primary" onclick="exportImg()">保存图片 (JPG)</button>
            <button class="btn-action btn-sec" onclick="toggleColor()">切换背景 (黑/白)</button>
            <button class="btn-action btn-sec" onclick="document.getElementById('file-bg').click()">上传自定义背景</button>
            <input type="file" id="file-bg" hidden onchange="setBg(this)">
        </div>
    </div>

    <div class="canvas-wrap">
        <div class="poster" id="poster">
            
            <div class="crop-marks">
                <div class="crop-corner c-tl"></div>
                <div class="crop-corner c-tr"></div>
                <div class="crop-corner c-bl"></div>
                <div class="crop-corner c-br"></div>
            </div>
            <div class="center-cross"></div>

            <div class="layer spec-watermark">Aa</div>
            
            <div class="layer spec-header">
                <div class="typo-val" style="font-size:16px; font-weight:800; letter-spacing:-0.2px;">自在致黑 Pro</div>
                <div class="tag-pill">免费商用</div>
            </div>

            <div class="layer spec-bar-top"></div>
            <div class="layer spec-info-col typo-label" style="text-align:right;">
                <span>VARIABLE FONT SPECIMEN</span>
                <span>NO. 0025-88</span>
            </div>
            
            <div class="layer spec-footer">
                <div class="b-footer-left">
                    <div class="data-block">
                        <span class="data-label">Weight</span>
                        <span class="data-val tabular-nums" id="disp-val-w">400</span>
                        <span class="data-desc" id="disp-txt-w">常规 Regular</span>
                    </div>
                    <div class="data-block">
                        <span class="data-label">Width</span>
                        <span class="data-val tabular-nums" id="disp-val-d">100</span>
                        <span class="data-desc" id="disp-txt-d">标准 Standard</span>
                    </div>
                </div>
                
                <div class="b-footer-right">
                    <div class="color-scale">
                        <div class="scale-block" style="background:#000"></div>
                        <div class="scale-block" style="background:#333"></div>
                        <div class="scale-block" style="background:#666"></div>
                        <div class="scale-block" style="background:#999"></div>
                        <div class="scale-block" style="background:#fff"></div>
                    </div>
                    <div class="credit-text">
                        @木头造字 Design and 2026
                    </div>
                </div>
            </div>

            <div class="stage" id="stage">
                <div class="main-text" id="text" contenteditable="true" spellcheck="false">自在<br>致黑</div>
            </div>

        </div>
    </div>

    <script>
        // DOM Elements
        const el = {
            poster: document.getElementById('poster'),
            text: document.getElementById('text'),
            stage: document.getElementById('stage'),
            // Sliders
            slider: { 
                w: document.getElementById('i-w'), 
                d: document.getElementById('i-d'), 
                s: document.getElementById('i-s'), 
                x: document.getElementById('i-x'), 
                y: document.getElementById('i-y') 
            },
            // Inputs
            input: {
                w: document.getElementById('in-val-w'),
                d: document.getElementById('in-val-d'),
                s: document.getElementById('in-val-s'),
                x: document.getElementById('in-val-x'),
                y: document.getElementById('in-val-y')
            },
            // Descriptions
            desc: {
                w: document.getElementById('desc-w'),
                d: document.getElementById('desc-d')
            },
            // Canvas Displays
            extra: { 
                wVal: document.getElementById('disp-val-w'),
                wTxt: document.getElementById('disp-txt-w'),
                dVal: document.getElementById('disp-val-d'),
                dTxt: document.getElementById('disp-txt-d')
            },
            btns: {
                w: document.getElementById('btn-play-w'),
                d: document.getElementById('btn-play-d')
            }
        };

        // Data Helpers
        function getWeightText(v) {
            v = parseInt(v);
            if(v<=200) return "极细";
            if(v<=300) return "纤细";
            if(v<=350) return "细体";
            if(v<=450) return "常规";
            if(v<=550) return "中粗";
            if(v<=650) return "粗体";
            return "特粗";
        }
        function getWidthText(v) {
            v = parseInt(v);
            if(v<=85) return "极窄";
            if(v<=95) return "偏窄";
            if(v<=105) return "标准";
            if(v<=115) return "偏宽";
            return "极宽";
        }

        // Core Update Logic
        function updateFromSlider(key) {
            const val = el.slider[key].value;
            el.input[key].value = val;
            if(key==='w' || key==='d') stopAnim(key); 
            draw();
        }

        function updateFromInput(key) {
            let val = parseFloat(el.input[key].value);
            const slider = el.slider[key];
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            if(isNaN(val)) val = (min+max)/2;
            if(val < min) val = min;
            if(val > max) val = max;
            
            el.input[key].value = val;
            el.slider[key].value = val;
            
            if(key==='w' || key==='d') stopAnim(key);
            draw();
        }

        function draw() {
            const w = parseFloat(el.slider.w.value);
            const d = parseFloat(el.slider.d.value);
            const s = el.slider.s.value;
            const x = el.slider.x.value;
            const y = el.slider.y.value;

            el.text.style.setProperty('font-variation-settings', `'wght' ${w}, 'wdth' ${d}`);
            el.text.style.fontSize = s + 'px';
            el.stage.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;

            const wTxt = getWeightText(w);
            const dTxt = getWidthText(d);
            
            if(el.desc.w) el.desc.w.innerText = wTxt;
            if(el.desc.d) el.desc.d.innerText = dTxt;

            el.extra.wVal.innerText = Math.round(w);
            el.extra.wTxt.innerText = wTxt + " Regular"; 
            
            // 重点调整：画布显示 Math.round(d)，去掉小数点
            el.extra.dVal.innerText = Math.round(d); 
            el.extra.dTxt.innerText = dTxt + " Standard";
        }

        const animState = {
            w: { active: false, dir: 1, min: 100, max: 700, speed: 8 }, 
            d: { active: false, dir: 1, min: 75, max: 125, speed: 0.3 } 
        };
        const icons = {
            play: '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>',
            pause: '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'
        };

        function toggleAnim(axis) {
            const st = animState[axis];
            st.active = !st.active;
            const btn = el.btns[axis];
            if(st.active) {
                btn.classList.add('playing');
                btn.innerHTML = icons.pause;
                loop(axis);
            } else {
                btn.classList.remove('playing');
                btn.innerHTML = icons.play;
            }
        }

        function stopAnim(axis) {
            if(animState[axis].active) {
                toggleAnim(axis);
            }
        }

        function loop(axis) {
            if(!animState[axis].active) return;
            const inputSlider = el.slider[axis];
            const inputVal = el.input[axis];
            let val = parseFloat(inputSlider.value);
            const st = animState[axis];

            val += st.speed * st.dir;
            if (val >= st.max) { val = st.max; st.dir = -1; } 
            else if (val <= st.min) { val = st.min; st.dir = 1; }

            inputSlider.value = val;
            
            // 左侧控制台保留小数，以便用户观察微小变化
            if(axis === 'd') inputVal.value = val.toFixed(1);
            else inputVal.value = Math.round(val);

            draw();
            requestAnimationFrame(() => loop(axis));
        }

        function setAlign(a) {
            el.text.style.textAlign = a;
            el.stage.style.justifyContent = a==='left'?'flex-start':a==='right'?'flex-end':'center';
            ['left','center','right'].forEach(k => document.getElementById('a-'+k).classList.remove('active'));
            document.getElementById('a-'+a).classList.add('active');
        }

        function resetPos() { 
            el.slider.x.value=0; el.input.x.value=0;
            el.slider.y.value=0; el.input.y.value=0;
            draw(); 
        }

        let isDark = false;
        function toggleColor() {
            isDark = !isDark;
            const s = el.poster.style;
            if(isDark) {
                s.setProperty('--p-bg', '#0A0A0A');
                s.setProperty('--p-ink', '#FFFFFF');
                s.setProperty('--p-sub', '#666666');
                s.setProperty('--p-line', 'rgba(255,255,255,0.1)');
                s.setProperty('--p-mark', 'rgba(255,255,255,0.4)');
            } else {
                s.setProperty('--p-bg', '#F0F0F0');
                s.setProperty('--p-ink', '#111111');
                s.setProperty('--p-sub', '#666666');
                s.setProperty('--p-line', 'rgba(0,0,0,0.1)');
                s.setProperty('--p-mark', 'rgba(0,0,0,0.8)');
            }
        }

        function setBg(input) {
            if(input.files[0]) {
                const fr = new FileReader();
                fr.onload = e => el.poster.style.backgroundImage = `url(${e.target.result})`;
                fr.readAsDataURL(input.files[0]);
            }
        }

        function exportImg() {
            const originalColor = el.text.style.caretColor;
            el.text.style.caretColor = 'transparent';
            html2canvas(el.poster, { scale: 2, backgroundColor: null }).then(canvas => {
                const a = document.createElement('a');
                a.href = canvas.toDataURL('image/jpeg', 0.95);
                a.download = `ZIZAO_Final_Int_${Date.now()}.jpg`;
                a.click();
                el.text.style.caretColor = originalColor;
            });
        }

        draw();
    </script>
</body>
</html>